---
description: JUnit 5 ê¸°ë°˜ ë‹¨ìœ„/í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„±, Mock ì‚¬ìš©ë²•, í…ŒìŠ¤íŠ¸ ì „ëµ, ì»¤ë²„ë¦¬ì§€ ëª©í‘œì™€ í…ŒìŠ¤íŠ¸ í’ˆì§ˆ ê°€ì´ë“œë¥¼ ì œê³µí•©ë‹ˆë‹¤.
globs: 
alwaysApply: false
---
# ğŸ§ª í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„± ê°€ì´ë“œë¼ì¸

## ğŸ¯ í…ŒìŠ¤íŠ¸ ì „ëµ ê°œìš”

### í…ŒìŠ¤íŠ¸ í”¼ë¼ë¯¸ë“œ
```
        /\
       /  \
      / E2E \      (ì†Œìˆ˜) - í†µí•© í…ŒìŠ¤íŠ¸, ì‹¤ì œ ì‹œë‚˜ë¦¬ì˜¤
     /______\
    /        \
   /   API    \    (ì¤‘ê°„) - ì»¨íŠ¸ë¡¤ëŸ¬, í†µí•© í…ŒìŠ¤íŠ¸
  /____________\
 /              \
/  Unit Tests    \  (ë‹¤ìˆ˜) - ì„œë¹„ìŠ¤, ë ˆí¬ì§€í† ë¦¬ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
/__________________\
```

### í…ŒìŠ¤íŠ¸ ì›ì¹™
- **F.I.R.S.T**: Fast, Independent, Repeatable, Self-Validating, Timely
- **AAA íŒ¨í„´**: Arrange, Act, Assert
- **Given-When-Then**: BDD ìŠ¤íƒ€ì¼ í…ŒìŠ¤íŠ¸ êµ¬ì¡°
- **ë‹¨ì¼ ì±…ì„**: í•˜ë‚˜ì˜ í…ŒìŠ¤íŠ¸ëŠ” í•˜ë‚˜ì˜ ê¸°ëŠ¥ë§Œ ê²€ì¦

## ğŸ“ í…ŒìŠ¤íŠ¸ ë””ë ‰í„°ë¦¬ êµ¬ì¡°

```
src/test/java/com/sbpb/ddobak/server/
â”œâ”€â”€ unit/                          # ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”œâ”€â”€ user/
â”‚   â”‚   â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ UserServiceTest.java
â”‚   â”‚   â”‚   â””â”€â”€ repository/
â”‚   â”‚   â”‚       â””â”€â”€ UserRepositoryTest.java
â”‚   â”‚   â””â”€â”€ auth/
â”‚   â”‚       â””â”€â”€ service/
â”‚   â”‚           â””â”€â”€ AuthServiceTest.java
â”‚   â””â”€â”€ common/
â”‚       â””â”€â”€ utils/
â”‚           â””â”€â”€ JwtUtilsTest.java
â”‚
â”œâ”€â”€ integration/                   # í†µí•© í…ŒìŠ¤íŠ¸
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â”œâ”€â”€ UserControllerTest.java
â”‚   â”‚   â””â”€â”€ AuthControllerTest.java
â”‚   â””â”€â”€ repository/
â”‚       â””â”€â”€ UserRepositoryIntegrationTest.java
â”‚
â”œâ”€â”€ config/                        # í…ŒìŠ¤íŠ¸ ì„¤ì •
â”‚   â”œâ”€â”€ TestConfig.java
â”‚   â””â”€â”€ TestContainerConfig.java
â”‚
â””â”€â”€ fixture/                       # í…ŒìŠ¤íŠ¸ ë°ì´í„°
    â”œâ”€â”€ UserFixture.java
    â””â”€â”€ AuthFixture.java
```

## ğŸ”§ í…ŒìŠ¤íŠ¸ í™˜ê²½ ì„¤ì •

### ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì„¤ì • (TestConfig.java)
```java
@TestConfiguration
@Profile("test")
public class TestConfig {
    
    @Bean
    @Primary
    public Clock testClock() {
        return Clock.fixed(
            Instant.parse("2024-01-01T00:00:00Z"), 
            ZoneId.systemDefault()
        );
    }
    
    @Bean
    @Primary
    public PasswordEncoder testPasswordEncoder() {
        // í…ŒìŠ¤íŠ¸ìš© ë¹ ë¥¸ ì¸ì½”ë”
        return new BCryptPasswordEncoder(4);
    }
}
```

### TestContainers ì„¤ì •
```java
@Testcontainers
@SpringBootTest
@TestPropertySource(properties = {
    "spring.datasource.url=jdbc:tc:mysql:8.0.33:///testdb",
    "spring.jpa.hibernate.ddl-auto=create-drop"
})
public abstract class IntegrationTestBase {
    
    @Container
    static MySQLContainer<?> mysql = new MySQLContainer<>("mysql:8.0.33")
            .withDatabaseName("testdb")
            .withUsername("test")
            .withPassword("test");
    
    @Container
    static GenericContainer<?> redis = new GenericContainer<>("redis:7.2-alpine")
            .withExposedPorts(6379);
    
    @DynamicPropertySource
    static void configureProperties(DynamicPropertyRegistry registry) {
        registry.add("spring.data.redis.host", redis::getHost);
        registry.add("spring.data.redis.port", redis::getFirstMappedPort);
    }
}
```

## ğŸ”¬ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„± ê°€ì´ë“œ

### Service ê³„ì¸µ í…ŒìŠ¤íŠ¸ ì˜ˆì‹œ
```java
@ExtendWith(MockitoExtension.class)
class UserServiceTest {
    
    @Mock
    private UserRepository userRepository;
    
    @Mock
    private PasswordEncoder passwordEncoder;
    
    @InjectMocks
    private UserService userService;
    
    @DisplayName("ì‚¬ìš©ì ìƒì„± - ì„±ê³µ")
    @Test
    void createUser_Success() {
        // Given
        CreateUserRequest request = CreateUserRequest.builder()
            .email("test@example.com")
            .name("í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì")
            .password("password123")
            .build();
        
        User savedUser = User.builder()
            .id(1L)
            .email(request.getEmail())
            .name(request.getName())
            .password("encoded-password")
            .status(UserStatus.ACTIVE)
            .build();
        
        when(userRepository.existsByEmail(request.getEmail())).thenReturn(false);
        when(passwordEncoder.encode(request.getPassword())).thenReturn("encoded-password");
        when(userRepository.save(any(User.class))).thenReturn(savedUser);
        
        // When
        UserResponse response = userService.createUser(request);
        
        // Then
        assertThat(response.getId()).isEqualTo(1L);
        assertThat(response.getEmail()).isEqualTo("test@example.com");
        assertThat(response.getName()).isEqualTo("í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì");
        
        verify(userRepository).existsByEmail(request.getEmail());
        verify(passwordEncoder).encode(request.getPassword());
        verify(userRepository).save(any(User.class));
    }
    
    @DisplayName("ì‚¬ìš©ì ìƒì„± - ì´ë©”ì¼ ì¤‘ë³µ ì˜ˆì™¸")
    @Test
    void createUser_DuplicateEmail_ThrowsException() {
        // Given
        CreateUserRequest request = CreateUserRequest.builder()
            .email("duplicate@example.com")
            .name("í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì")
            .password("password123")
            .build();
        
        when(userRepository.existsByEmail(request.getEmail())).thenReturn(true);
        
        // When & Then
        assertThatThrownBy(() -> userService.createUser(request))
            .isInstanceOf(DuplicateEmailException.class)
            .hasMessageContaining("duplicate@example.com");
        
        verify(userRepository).existsByEmail(request.getEmail());
        verify(userRepository, never()).save(any(User.class));
    }
}
```

### Repository í…ŒìŠ¤íŠ¸ ì˜ˆì‹œ
```java
@DataJpaTest
@AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.NONE)
class UserRepositoryTest {
    
    @Autowired
    private TestEntityManager entityManager;
    
    @Autowired
    private UserRepository userRepository;
    
    @DisplayName("ì´ë©”ì¼ë¡œ ì‚¬ìš©ì ì¡°íšŒ - ì„±ê³µ")
    @Test
    void findByEmail_Success() {
        // Given
        User user = User.builder()
            .email("test@example.com")
            .name("í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì")
            .password("password")
            .status(UserStatus.ACTIVE)
            .build();
        
        entityManager.persistAndFlush(user);
        
        // When
        Optional<User> found = userRepository.findByEmail("test@example.com");
        
        // Then
        assertThat(found).isPresent();
        assertThat(found.get().getEmail()).isEqualTo("test@example.com");
        assertThat(found.get().getName()).isEqualTo("í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì");
    }
    
    @DisplayName("ì´ë©”ì¼ ì¡´ì¬ ì—¬ë¶€ í™•ì¸")
    @Test
    void existsByEmail_ReturnsTrue_WhenEmailExists() {
        // Given
        User user = User.builder()
            .email("existing@example.com")
            .name("ê¸°ì¡´ ì‚¬ìš©ì")
            .password("password")
            .status(UserStatus.ACTIVE)
            .build();
        
        entityManager.persistAndFlush(user);
        
        // When
        boolean exists = userRepository.existsByEmail("existing@example.com");
        
        // Then
        assertThat(exists).isTrue();
    }
}
```

## ğŸŒ í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„± ê°€ì´ë“œ

### Controller í†µí•© í…ŒìŠ¤íŠ¸
```java
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
@AutoConfigureMockMvc
@Transactional
class UserControllerIntegrationTest extends IntegrationTestBase {
    
    @Autowired
    private MockMvc mockMvc;
    
    @Autowired
    private ObjectMapper objectMapper;
    
    @Autowired
    private UserRepository userRepository;
    
    @DisplayName("ì‚¬ìš©ì ìƒì„± API - ì„±ê³µ")
    @Test
    void createUser_Success() throws Exception {
        // Given
        CreateUserRequest request = CreateUserRequest.builder()
            .email("test@example.com")
            .name("í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì")
            .password("password123")
            .build();
        
        // When & Then
        mockMvc.perform(post("/api/v1/users")
                .contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(request)))
            .andExpect(status().isCreated())
            .andExpect(jsonPath("$.success").value(true))
            .andExpect(jsonPath("$.data.email").value("test@example.com"))
            .andExpect(jsonPath("$.data.name").value("í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì"));
        
        // ë°ì´í„°ë² ì´ìŠ¤ ê²€ì¦
        Optional<User> savedUser = userRepository.findByEmail("test@example.com");
        assertThat(savedUser).isPresent();
    }
    
    @DisplayName("ì‚¬ìš©ì ìƒì„± API - ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨")
    @Test
    void createUser_ValidationFail() throws Exception {
        // Given
        CreateUserRequest request = CreateUserRequest.builder()
            .email("invalid-email")  // ì˜ëª»ëœ ì´ë©”ì¼ í˜•ì‹
            .name("")               // ë¹ˆ ì´ë¦„
            .password("123")        // ì§§ì€ ë¹„ë°€ë²ˆí˜¸
            .build();
        
        // When & Then
        mockMvc.perform(post("/api/v1/users")
                .contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(request)))
            .andExpect(status().isBadRequest())
            .andExpect(jsonPath("$.success").value(false))
            .andExpect(jsonPath("$.error.code").value("INVALID_INPUT"));
    }
}
```

## ğŸ­ í…ŒìŠ¤íŠ¸ ë°ì´í„° Fixture

### UserFixture í´ë˜ìŠ¤
```java
public class UserFixture {
    
    public static User defaultUser() {
        return User.builder()
            .id(1L)
            .email("test@example.com")
            .name("í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì")
            .password("encoded-password")
            .status(UserStatus.ACTIVE)
            .createdAt(LocalDateTime.of(2024, 1, 1, 0, 0))
            .updatedAt(LocalDateTime.of(2024, 1, 1, 0, 0))
            .build();
    }
    
    public static User userWithEmail(String email) {
        return defaultUser().toBuilder()
            .email(email)
            .build();
    }
    
    public static CreateUserRequest createUserRequest() {
        return CreateUserRequest.builder()
            .email("test@example.com")
            .name("í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì")
            .password("password123")
            .build();
    }
    
    public static List<User> activeUsers(int count) {
        return IntStream.range(0, count)
            .mapToObj(i -> defaultUser().toBuilder()
                .id((long) (i + 1))
                .email("user" + i + "@example.com")
                .build())
            .collect(Collectors.toList());
    }
}
```

## ğŸ” í…ŒìŠ¤íŠ¸ ê²€ì¦ íŒ¨í„´

### AssertJ ì‚¬ìš© ì˜ˆì‹œ
```java
// ê¸°ë³¸ ê²€ì¦
assertThat(user.getName()).isEqualTo("í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì");
assertThat(user.isActive()).isTrue();

// ì»¬ë ‰ì…˜ ê²€ì¦
assertThat(users)
    .hasSize(3)
    .extracting(User::getEmail)
    .containsExactly("user1@test.com", "user2@test.com", "user3@test.com");

// ì˜ˆì™¸ ê²€ì¦
assertThatThrownBy(() -> userService.getUserById(999L))
    .isInstanceOf(UserNotFoundException.class)
    .hasMessageContaining("User not found with ID: 999");

// ê°ì²´ í•„ë“œ ê²€ì¦
assertThat(response)
    .extracting("id", "email", "name")
    .containsExactly(1L, "test@example.com", "í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì");
```

## ğŸ“Š í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ëª©í‘œ

### ì»¤ë²„ë¦¬ì§€ ê¸°ì¤€
- **Line Coverage**: ìµœì†Œ 80%
- **Branch Coverage**: ìµœì†Œ 70%
- **Class Coverage**: ìµœì†Œ 90%

### ìš°ì„ ìˆœìœ„
1. **Service ê³„ì¸µ**: 95% ì´ìƒ (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ í•µì‹¬)
2. **Repository ê³„ì¸µ**: 85% ì´ìƒ (ë°ì´í„° ì ‘ê·¼ ë¡œì§)
3. **Controller ê³„ì¸µ**: 80% ì´ìƒ (API ì¸í„°í˜ì´ìŠ¤)
4. **Utility í´ë˜ìŠ¤**: 90% ì´ìƒ (ê³µí†µ ê¸°ëŠ¥)

## ğŸš« í…ŒìŠ¤íŠ¸ ì•ˆí‹° íŒ¨í„´

### í”¼í•´ì•¼ í•  íŒ¨í„´ë“¤
```java
// âŒ í…ŒìŠ¤íŠ¸ ê°„ ì˜ì¡´ì„±
@Test
void test1() {
    // ì „ì—­ ë³€ìˆ˜ ì„¤ì •
}

@Test
void test2() {
    // test1 ê²°ê³¼ì— ì˜ì¡´
}

// âŒ ë„ˆë¬´ ë§ì€ ê²€ì¦
@Test
void testEverything() {
    // 10ê°œ ì´ìƒì˜ assert
}

// âŒ ì˜ë¯¸ ì—†ëŠ” í…ŒìŠ¤íŠ¸
@Test
void testGetter() {
    user.setName("test");
    assertEquals("test", user.getName());
}

// âœ… ì¢‹ì€ í…ŒìŠ¤íŠ¸
@Test
@DisplayName("ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì‹œ ì•”í˜¸í™”ë˜ì–´ ì €ì¥ëœë‹¤")
void changePassword_ShouldEncryptAndSave() {
    // Given
    User user = UserFixture.defaultUser();
    String newPassword = "newPassword123";
    
    // When
    user.changePassword(newPassword, passwordEncoder);
    
    // Then
    assertThat(user.getPassword()).isNotEqualTo(newPassword);
    assertThat(passwordEncoder.matches(newPassword, user.getPassword())).isTrue();
}
```

## ğŸ“‹ í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

### í…ŒìŠ¤íŠ¸ ì‘ì„± ì „ í™•ì¸ì‚¬í•­
- [ ] í…ŒìŠ¤íŠ¸í•  ê¸°ëŠ¥ì´ ëª…í™•í•œê°€?
- [ ] Given-When-Then êµ¬ì¡°ë¡œ ì‘ì„±í–ˆëŠ”ê°€?
- [ ] í…ŒìŠ¤íŠ¸ ë©”ì„œë“œëª…ì´ ì˜ë„ë¥¼ ëª…í™•íˆ í‘œí˜„í•˜ëŠ”ê°€?
- [ ] í•˜ë‚˜ì˜ í…ŒìŠ¤íŠ¸ê°€ í•˜ë‚˜ì˜ ì‹œë‚˜ë¦¬ì˜¤ë§Œ ê²€ì¦í•˜ëŠ”ê°€?
- [ ] Mock ê°ì²´ ì‚¬ìš©ì´ ì ì ˆí•œê°€?
- [ ] ê²½ê³„ê°’ í…ŒìŠ¤íŠ¸ê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ê°€?
- [ ] ì˜ˆì™¸ ìƒí™© í…ŒìŠ¤íŠ¸ê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ê°€?
